<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sura Charades</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, getDoc, updateDoc, onSnapshot, arrayUnion, arrayRemove, serverTimestamp, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        window.firebaseModules = { 
            initializeApp, getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, signOut,
            getFirestore, collection, doc, setDoc, getDoc, updateDoc, onSnapshot, arrayUnion, arrayRemove, serverTimestamp, deleteDoc
        };
    </script>

    <style>
        body {
            font-family: 'Fredoka', sans-serif;
            background-color: #f0f9ff;
            color: #1e293b;
            background-image: radial-gradient(#bae6fd 2px, transparent 2px);
            background-size: 32px 32px;
            overflow-x: hidden; /* Prevent horizontal scroll */
        }
        .font-title { font-family: 'Bangers', cursive; letter-spacing: 2px; }
        .comic-shadow { box-shadow: 4px 4px 0px 0px #000000; border: 3px solid #000000; }
        .comic-shadow:active { box-shadow: 0px 0px 0px 0px #000000; transform: translate(4px, 4px); }
        .comic-card { box-shadow: 8px 8px 0px 0px #000000; border: 4px solid #000000; }
        .card-flip { perspective: 1000px; }
        .card-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s; transform-style: preserve-3d; }
        .card-flip.flipped .card-inner { transform: rotateY(180deg); }
        .card-front, .card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; flex-direction: column; border-radius: 1rem; }
        .card-back { transform: rotateY(180deg); }
        
        @keyframes float { 
            0% { transform: translateY(0px) rotate(-5deg); } 
            50% { transform: translateY(-10px) rotate(5deg); } 
            100% { transform: translateY(0px) rotate(-5deg); } 
        }
        .animate-float { animation: float 4s ease-in-out infinite; }
        .animate-float-delay { animation: float 4s ease-in-out infinite; animation-delay: 2s; }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #000; border-radius: 3px; }
        
        /* Mobile text stroke fix */
        .text-stroke { -webkit-text-stroke: 1.5px black; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- ICONS ---
        const IconBase = ({ children, className = "", ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>
        );
        const Users = (props) => (<IconBase {...props}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></IconBase>);
        const Play = (props) => (<IconBase {...props}><polygon points="5 3 19 12 5 21 5 3"/></IconBase>);
        const ShieldAlert = (props) => (<IconBase {...props}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></IconBase>);
        const Crown = (props) => (<IconBase {...props}><path d="m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14"/></IconBase>);
        const LogOut = (props) => (<IconBase {...props}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></IconBase>);
        const Loader2 = (props) => (<IconBase {...props}><path d="M21 12a9 9 0 1 1-6.219-8.56"/></IconBase>);
        const Shuffle = (props) => (<IconBase {...props}><path d="M2 18h1.4c1.3 0 2.5-.6 3.3-1.7l14.2-12.6"/><path d="M22 5h-1.4c-1.3 0-2.5.6-3.3 1.7L3.1 19.3"/><path d="M16 5h6v6"/><path d="M16 19h6v-6"/></IconBase>);
        const Eye = (props) => (<IconBase {...props}><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></IconBase>);
        const EyeOff = (props) => (<IconBase {...props}><path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"/><path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"/><path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7c.44 0 .87-.03 1.28-.09"/><line x1="2" y1="2" x2="22" y2="22"/></IconBase>);
        const Vote = (props) => (<IconBase {...props}><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></IconBase>);
        const UserPlus = (props) => (<IconBase {...props}><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="23" y1="11" x2="17" y2="11"/></IconBase>);
        const CheckCircle2 = (props) => (<IconBase {...props}><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></IconBase>);
        const ArrowLeft = (props) => (<IconBase {...props}><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></IconBase>);
        const Skull = (props) => (<IconBase {...props}><path d="m12.5 17-.5-1-.5 1h1z"/><circle cx="9" cy="12" r="1"/><circle cx="15" cy="12" r="1"/><path d="M8.5 20.5A2 2 0 0 1 6.5 19v-2a6 6 0 1 1 11 0v2a2 2 0 0 1-2 2h-7z"/></IconBase>);
        const Globe = (props) => (<IconBase {...props}><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/></IconBase>);
        const PenTool = (props) => (<IconBase {...props}><path d="m12 19 7-7 3 3-7 7-3-3z"/><path d="m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/><path d="m2 2 7.586 7.586"/><circle cx="11" cy="11" r="2"/></IconBase>);

        // --- DYNAMIC WORD GENERATOR ---
        const SIMPLE_SEEDS = [
            { w: "Dog", c: "Animals" }, { w: "Cat", c: "Animals" }, { w: "Lion", c: "Animals" }, { w: "Fish", c: "Animals" }, { w: "Bird", c: "Animals" },
            { w: "Apple", c: "Food" }, { w: "Banana", c: "Food" }, { w: "Pizza", c: "Food" }, { w: "Bread", c: "Food" }, { w: "Cake", c: "Food" }, { w: "Rice", c: "Food" },
            { w: "Car", c: "Transport" }, { w: "Bus", c: "Transport" }, { w: "Bike", c: "Transport" }, { w: "Plane", c: "Transport" }, { w: "Train", c: "Transport" },
            { w: "Sun", c: "Nature" }, { w: "Moon", c: "Nature" }, { w: "Rain", c: "Nature" }, { w: "Tree", c: "Nature" }, { w: "Flower", c: "Nature" }, { w: "Fire", c: "Nature" },
            { w: "Chair", c: "Home" }, { w: "Table", c: "Home" }, { w: "Bed", c: "Home" }, { w: "Door", c: "Home" }, { w: "Window", c: "Home" }, { w: "Spoon", c: "Home" },
            { w: "Shirt", c: "Clothes" }, { w: "Shoe", c: "Clothes" }, { w: "Hat", c: "Clothes" }, { w: "Pants", c: "Clothes" }, { w: "Coat", c: "Clothes" },
            { w: "Soccer", c: "Sports" }, { w: "Tennis", c: "Sports" }, { w: "Ball", c: "Sports" }, { w: "Run", c: "Sports" },
            { w: "Book", c: "Objects" }, { w: "Pen", c: "Objects" }, { w: "Phone", c: "Objects" }, { w: "Box", c: "Objects" }, { w: "Bag", c: "Objects" }, { w: "Clock", c: "Objects" },
            { w: "Hand", c: "Body" }, { w: "Eye", c: "Body" }, { w: "Head", c: "Body" }, { w: "Leg", c: "Body" }, { w: "Hair", c: "Body" }
        ];

        const FALLBACK_DATA = [
            { cat: "Animals", normal: "Lion", imposter: "Tiger" },
            { cat: "Tech", normal: "Phone", imposter: "Tablet" },
            { cat: "Food", normal: "Pizza", imposter: "Burger" },
            { cat: "Places", normal: "Cinema", imposter: "Theatre" },
            { cat: "Transport", normal: "Train", imposter: "Bus" }
        ];

        // --- FIREBASE SETUP ---
        const { 
            initializeApp, getAuth, signInAnonymously, onAuthStateChanged,
            getFirestore, doc, setDoc, getDoc, updateDoc, onSnapshot, arrayUnion, arrayRemove, serverTimestamp 
        } = window.firebaseModules || {};

        let useMockBackend = false;
        let auth, db, appId;
        
        const USER_PROVIDED_CONFIG = {
            apiKey: "AIzaSyCJhCcgXApr5Ne3WwAe3To_od48aIOwwOE",
            authDomain: "suracharades.firebaseapp.com",
            projectId: "suracharades",
            storageBucket: "suracharades.firebasestorage.app",
            messagingSenderId: "449241872120",
            appId: "1:449241872120:web:f49b4e1211566ab0bb2d0d",
            measurementId: "G-32VKLQKFZR"
        };

        try {
            const envConfig = window.__firebase_config ? JSON.parse(window.__firebase_config) : null;
            const localConfig = localStorage.getItem('sura_firebase_config') ? JSON.parse(localStorage.getItem('sura_firebase_config')) : null;
            const config = USER_PROVIDED_CONFIG || envConfig || localConfig;

            if (config && Object.keys(config).length > 0 && initializeApp) {
                const app = initializeApp(config);
                auth = getAuth(app);
                db = getFirestore(app);
                appId = (typeof __app_id !== 'undefined' ? __app_id : 'sura-charades');
            } else {
                throw new Error("No config found");
            }
        } catch (e) {
            console.log("Running in Simulation Mode");
            useMockBackend = true;
        }

        // --- HELPER FUNCTION: WORD FETCHING ---
        const fetchGameWords = async (mode, customData) => {
            if (mode === 'custom' && customData) {
                return { cat: "Custom", normal: customData.normal, imposter: customData.imposter };
            }
            try {
                const selection = SIMPLE_SEEDS[Math.floor(Math.random() * SIMPLE_SEEDS.length)];
                const seedWord = selection.w;
                const category = selection.c;
                const response = await fetch(`https://api.datamuse.com/words?ml=${seedWord}&max=20`);
                const data = await response.json();

                if (data && data.length >= 2) {
                    const candidates = data.filter(item => 
                        !item.word.includes(' ') && !item.word.includes('-') &&
                        item.word.toLowerCase() !== seedWord.toLowerCase() && item.word.length <= 10
                    );
                    
                    if (candidates.length > 0) {
                        const limit = Math.min(candidates.length, 8);
                        const randomIndex = Math.floor(Math.random() * limit);
                        const imposterWord = candidates[randomIndex].word;
                        const w1 = seedWord.charAt(0).toUpperCase() + seedWord.slice(1);
                        const w2 = imposterWord.charAt(0).toUpperCase() + imposterWord.slice(1);
                        return { cat: category, normal: w1, imposter: w2 };
                    }
                }
                throw new Error("Not enough simple words found");
            } catch (err) {
                return FALLBACK_DATA[Math.floor(Math.random() * FALLBACK_DATA.length)];
            }
        };

        // --- MAIN APP ---
        function App() {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('loading');
            const [playerName, setPlayerName] = useState(localStorage.getItem('sura_username') || '');
            const [inputCode, setInputCode] = useState('');
            const [activeRoomId, setActiveRoomId] = useState('');
            const [roomData, setRoomData] = useState(null);
            const [error, setError] = useState('');
            const [isHost, setIsHost] = useState(false);
            const [revealWord, setRevealWord] = useState(false);
            const [myVote, setMyVote] = useState(null);
            const [isDemo, setIsDemo] = useState(useMockBackend);
            
            const [gameMode, setGameMode] = useState('auto'); 
            const [customNormal, setCustomNormal] = useState('');
            const [customImposter, setCustomImposter] = useState('');
            const [isLoadingWords, setIsLoadingWords] = useState(false);

            useEffect(() => {
                const init = async () => {
                    if (useMockBackend) {
                        setTimeout(() => { setUser({ uid: 'mock-user-1', isAnonymous: true }); setView('landing'); }, 1000);
                        return;
                    }
                    try {
                        await signInAnonymously(auth);
                        onAuthStateChanged(auth, (u) => { setUser(u); if (u) setView('landing'); });
                    } catch (e) {
                        useMockBackend = true; setIsDemo(true); setUser({ uid: 'mock-user-1', isAnonymous: true }); setView('landing');
                    }
                };
                init();
            }, []);

            useEffect(() => {
                if (useMockBackend || !activeRoomId || !user) return; 
                const roomRef = doc(db, 'artifacts', appId, 'public', 'data', 'rooms', activeRoomId);
                const unsub = onSnapshot(roomRef, (docSnap) => {
                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        setRoomData(data);
                        setIsHost(data.hostId === user.uid);
                        if (data.status === 'lobby') setView('lobby');
                        if (['playing', 'voting', 'ended'].includes(data.status)) setView('game');
                        
                        const me = data.players.find(p => p.uid === user.uid);
                        if (me && me.isEliminated && data.status !== 'ended') {
                            setRevealWord(false);
                        }
                    } else {
                        if (view !== 'landing') { alert("Room closed."); leaveRoom(); }
                    }
                });
                return () => unsub();
            }, [activeRoomId, user, view]);

            useEffect(() => { if (playerName) localStorage.setItem('sura_username', playerName); }, [playerName]);

            const createRoom = async () => {
                if (!playerName.trim()) return setError("Enter your name!");
                const code = Math.random().toString(36).substring(2, 6).toUpperCase();
                const newRoomData = {
                    roomId: code, hostId: user.uid, status: 'lobby',
                    players: [{ uid: user.uid, name: playerName, isHost: true, joinedAt: Date.now(), vote: null, isEliminated: false }],
                    category: '', commonWord: '', imposterWord: '', imposterId: '', createdAt: serverTimestamp()
                };

                if (useMockBackend) {
                    setActiveRoomId(code); setInputCode(code); setRoomData(newRoomData); setIsHost(true); setView('lobby');
                    setTimeout(() => setRoomData(prev => ({...prev, players: [...prev.players, { uid: 'bot1', name: 'Bot', isHost: false, isEliminated: false }, { uid: 'bot2', name: 'Bot 2', isHost: false, isEliminated: false }]})), 1500);
                } else {
                    try { await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'rooms', code), newRoomData); setActiveRoomId(code); setInputCode(code); } catch (err) { setError("Failed to create."); }
                }
            };

            const joinRoom = async () => {
                if (!playerName.trim()) return setError("Enter Name!");
                const codeToJoin = inputCode.toUpperCase().trim();
                if (!codeToJoin) return setError("Enter Code!");
                if (useMockBackend) return setError("Offline mode: Create only.");

                try {
                    const roomRef = doc(db, 'artifacts', appId, 'public', 'data', 'rooms', codeToJoin);
                    const docSnap = await getDoc(roomRef);
                    if (!docSnap.exists()) return setError("Room not found!");
                    
                    const data = docSnap.data();
                    if (!data.players.some(p => p.uid === user.uid)) {
                        await updateDoc(roomRef, { 
                            players: arrayUnion({ uid: user.uid, name: playerName, isHost: false, joinedAt: Date.now(), vote: null, isEliminated: false }) 
                        });
                    }
                    setActiveRoomId(codeToJoin); 
                } catch (err) { setError("Failed to join."); }
            };

            const leaveRoom = async () => {
                if (!useMockBackend && activeRoomId && user && roomData) {
                    try {
                        const me = roomData.players.find(p => p.uid === user.uid);
                        if(me) await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'rooms', activeRoomId), { players: arrayRemove(me) });
                    } catch(e) {}
                }
                setActiveRoomId(''); setRoomData(null); setIsHost(false); setView('landing'); setError('');
            };

            const startGame = async () => {
                if(gameMode === 'custom' && (!customNormal || !customImposter)) { alert("Please enter both words for Custom Mode!"); return; }
                setIsLoadingWords(true);
                const wordData = await fetchGameWords(gameMode, { normal: customNormal, imposter: customImposter });
                setIsLoadingWords(false);

                const playerList = [...roomData.players];
                const imposterIndex = Math.floor(Math.random() * playerList.length);
                const imposterId = playerList[imposterIndex].uid;
                const resetPlayers = playerList.map(p => ({ ...p, vote: null, isEliminated: false }));

                const updates = { status: 'playing', category: wordData.cat, commonWord: wordData.normal, imposterWord: wordData.imposter, imposterId: imposterId, players: resetPlayers };

                if (useMockBackend) { setRoomData(prev => ({ ...prev, ...updates })); setView('game'); }
                else { await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'rooms', activeRoomId), updates); }
                setRevealWord(false); setMyVote(null);
            };

            const toggleVoting = async () => {
                if (useMockBackend) setRoomData(prev => ({ ...prev, status: 'voting' }));
                else await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'rooms', activeRoomId), { status: 'voting' });
            };

            const handleVoteCompletion = async () => {
                if (!isHost || !roomData) return;
                const counts = {}; let maxVotes = 0; let candidates = [];
                roomData.players.forEach(p => { if (p.vote && !p.isEliminated) { counts[p.vote] = (counts[p.vote] || 0) + 1; if (counts[p.vote] > maxVotes) maxVotes = counts[p.vote]; } });
                Object.keys(counts).forEach(uid => { if (counts[uid] === maxVotes) candidates.push(uid); });

                if (maxVotes === 0) { alert("No votes! Continuing..."); updateGameStatus('playing', roomData.players.map(p => ({...p, vote: null}))); return; }

                if (candidates.includes(roomData.imposterId)) {
                    if(useMockBackend) setRoomData(prev => ({...prev, status: 'ended'}));
                    else await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'rooms', activeRoomId), { status: 'ended' });
                    return;
                }

                let updatedPlayers = roomData.players.map(p => {
                    if (candidates.length === 1 && p.uid === candidates[0]) return { ...p, isEliminated: true, vote: null };
                    return { ...p, vote: null };
                });
                
                if (candidates.length > 1) alert("It's a tie! No one out.");

                // CHECK FOR 2 PLAYERS LEFT CONDITION
                const aliveCount = updatedPlayers.filter(p => !p.isEliminated).length;
                if (aliveCount <= 2) {
                     if(useMockBackend) setRoomData(prev => ({...prev, status: 'ended', players: updatedPlayers}));
                     else await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'rooms', activeRoomId), { status: 'ended', players: updatedPlayers });
                } else {
                     updateGameStatus('playing', updatedPlayers);
                }
            };

            const updateGameStatus = async (status, players) => {
                if(useMockBackend) setRoomData(prev => ({...prev, status, players}));
                else await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'rooms', activeRoomId), { status, players });
            };

            const endGame = async () => {
                if (useMockBackend) setRoomData(prev => ({ ...prev, status: 'ended' }));
                else await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'rooms', activeRoomId), { status: 'ended' });
            };

            const resetToLobby = async () => {
                if (useMockBackend) { setRoomData(prev => ({ ...prev, status: 'lobby' })); setView('lobby'); }
                else await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'rooms', activeRoomId), { status: 'lobby' });
            };

            const castVote = async (targetUid) => {
                if (roomData.status !== 'voting') return;
                if (roomData.players.find(p => p.uid === user.uid).isEliminated) return;
                if (targetUid === user.uid) return setError("Can't self vote!");
                const updatedPlayers = roomData.players.map(p => p.uid === user.uid ? { ...p, vote: targetUid } : p);
                if (useMockBackend) { setRoomData(prev => ({ ...prev, players: updatedPlayers })); setTimeout(() => setRoomData(prev => ({...prev, players: prev.players.map(p => (p.uid.startsWith('bot') && !p.vote) ? {...p, vote: user.uid} : p)})), 1000); } 
                else { await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'rooms', activeRoomId), { players: updatedPlayers }); }
                setMyVote(targetUid);
            };

            // --- COMPUTED ---
            const myData = roomData?.players.find(p => p.uid === user.uid);
            const isImposter = roomData && user && roomData.imposterId === user.uid;
            const myWord = isImposter ? roomData?.imposterWord : roomData?.commonWord;
            const playersList = roomData?.players || [];
            const voteCounts = {}; let maxVotes = 0;
            if (roomData) playersList.forEach(p => { if (p.vote && !p.isEliminated) { voteCounts[p.vote] = (voteCounts[p.vote] || 0) + 1; if (voteCounts[p.vote] > maxVotes) maxVotes = voteCounts[p.vote]; } });

            if (view === 'loading') return <div className="min-h-screen flex items-center justify-center bg-sky-50"><Loader2 className="w-12 h-12 text-black animate-spin" /></div>;

            return (
                <div className={`min-h-screen ${isDemo ? 'border-t-8 border-orange-400' : ''}`}>
                    {isDemo && view === 'landing' && <div className="bg-orange-100 text-orange-800 p-2 text-center text-xs font-bold font-sans">OFFLINE DEMO MODE</div>}

                    {view === 'landing' && (
                         <div className="min-h-screen flex flex-col items-center justify-center p-4 relative overflow-y-auto pb-20 safe-area-bottom">
                            {/* Images: Flexible for Mobile, Absolute for Desktop */}
                            <div className="w-full max-w-md flex justify-between items-center mb-4 lg:absolute lg:max-w-5xl lg:mb-0 lg:top-1/2 lg:-translate-y-1/2 lg:z-0 lg:pointer-events-none">
                                <div className="flex flex-col items-center animate-float transform scale-75 md:scale-90 lg:scale-100">
                                    <span className="font-title text-2xl lg:text-3xl text-green-500 -rotate-12 mb-2" style={{textShadow: '2px 2px 0 #000'}}>REAL</span>
                                    <img src="sura100.png" onError={(e) => { e.target.onerror = null; e.target.src = "https://placehold.co/150x150/86efac/000000?text=REAL"; }} className="w-24 h-24 lg:w-40 lg:h-40 object-contain drop-shadow-xl"/>
                                </div>
                                <div className="flex flex-col items-center animate-float-delay transform scale-75 md:scale-90 lg:scale-100">
                                    <span className="font-title text-2xl lg:text-3xl text-red-500 rotate-12 mb-2" style={{textShadow: '2px 2px 0 #000'}}>IMPOSTER</span>
                                    <img src="sura80.png" onError={(e) => { e.target.onerror = null; e.target.src = "https://placehold.co/150x150/fca5a5/000000?text=IMPOSTER"; }} className="w-24 h-24 lg:w-40 lg:h-40 object-contain drop-shadow-xl"/>
                                </div>
                            </div>

                            <div className="w-full max-w-md bg-white p-6 md:p-8 rounded-2xl z-10 comic-card transform transition-all shadow-xl">
                                <div className="text-center space-y-2 mb-6">
                                    <h1 className="font-title text-4xl md:text-6xl text-yellow-400 tracking-wider stroke-black text-stroke"><span style={{WebkitTextStroke: '2px black', textShadow: '4px 4px 0 #000'}}>SURA CHARADES</span></h1>
                                    <p className="text-slate-500 font-bold text-base md:text-lg">Who is faking it?</p>
                                </div>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-base font-title text-slate-800 mb-1">YOUR NAME</label>
                                        <input type="text" value={playerName} onChange={(e) => setPlayerName(e.target.value)} className="w-full px-4 py-3 rounded-xl border-2 border-black bg-slate-50 font-bold text-lg shadow-[4px_4px_0_0_rgba(0,0,0,0.1)] focus:shadow-[4px_4px_0_0_rgba(0,0,0,1)] outline-none" placeholder="Enter nickname..."/>
                                    </div>
                                    <div className="pt-4 border-t-2 border-dashed border-slate-300">
                                        <button onClick={createRoom} className="w-full bg-yellow-400 hover:bg-yellow-300 text-black font-title text-xl py-3 px-4 rounded-xl flex justify-center gap-2 mb-4 comic-shadow active:translate-y-1 active:shadow-none"><Crown className="w-6 h-6" /> {isDemo ? 'HOST DEMO' : 'HOST GAME'}</button>
                                        <div className="flex gap-2 flex-col sm:flex-row">
                                            <input type="text" value={inputCode} onChange={(e) => setInputCode(e.target.value.toUpperCase())} disabled={isDemo} className="w-full sm:flex-1 px-4 py-3 rounded-xl border-2 border-black text-center font-black text-xl bg-slate-50 shadow-[4px_4px_0_0_rgba(0,0,0,0.1)] outline-none uppercase tracking-widest" placeholder={isDemo ? "OFFLINE" : "CODE"} maxLength={4}/>
                                            <button onClick={joinRoom} disabled={isDemo} className="w-full sm:flex-1 bg-sky-400 hover:bg-sky-300 text-black font-title text-xl py-3 px-4 rounded-xl flex justify-center gap-2 comic-shadow active:translate-y-1 active:shadow-none"><LogOut className="w-6 h-6 rotate-180" /> JOIN</button>
                                        </div>
                                    </div>
                                </div>
                                {error && <div className="mt-4 p-3 bg-red-100 border-2 border-red-500 text-red-600 font-bold rounded-lg flex items-center gap-2 shadow-[4px_4px_0_0_#ef4444]"><ShieldAlert className="w-5 h-5" /> {error}</div>}
                            </div>
                        </div>
                    )}

                    {view === 'lobby' && (
                        <div className="min-h-screen p-4 flex flex-col items-center">
                            <div className="w-full max-w-md space-y-6">
                                <div className="flex justify-between items-center gap-2">
                                    <button onClick={leaveRoom} className="bg-white border-2 border-slate-300 text-slate-700 px-3 py-2 rounded-xl font-bold text-xs md:text-sm hover:bg-slate-50 flex items-center gap-1 shadow-sm shrink-0"><ArrowLeft className="w-4 h-4" /> LEAVE</button>
                                    <div className="bg-yellow-400 border-2 border-black text-black px-3 py-1.5 rounded-full font-title tracking-wide text-base md:text-lg shadow-[2px_2px_0_0_rgba(0,0,0,1)] transform -rotate-2 truncate max-w-[150px] md:max-w-xs">{playerName}</div>
                                </div>
                                <div className="bg-white p-6 rounded-2xl comic-card text-center relative overflow-hidden"><div className="absolute top-0 left-0 w-full h-2 bg-indigo-500"></div><p className="text-slate-500 font-bold uppercase tracking-wider">Room Code</p><h2 className="font-title text-5xl md:text-6xl text-indigo-600 tracking-widest my-2 drop-shadow-md">{activeRoomId}</h2><p className="text-slate-400 font-medium text-sm">{isDemo ? "Demo Mode" : "Waiting for players..."}</p></div>
                                <div className="bg-white p-6 rounded-2xl comic-card"><h3 className="text-lg md:text-xl font-title text-slate-800 mb-4 flex items-center gap-2 border-b-2 border-slate-100 pb-2"><Users className="w-6 h-6 text-indigo-500" /> PLAYERS ({playersList.length})</h3><div className="space-y-3 max-h-60 overflow-y-auto pr-2 custom-scroll">{playersList.map(p => (<div key={p.uid} className="flex items-center justify-between p-3 bg-slate-50 border-2 border-slate-200 rounded-xl"><span className="font-bold text-base md:text-lg text-slate-700">{p.name} {p.uid === user.uid && '(You)'}</span>{p.isHost && <Crown className="w-5 h-5 text-yellow-500 fill-current" />}</div>))}</div></div>
                                
                                {isHost ? (
                                    <div className="space-y-3">
                                        <div className="bg-white p-4 rounded-xl border-2 border-slate-200">
                                            <p className="text-sm font-bold text-slate-500 mb-2 uppercase">Word Source</p>
                                            <div className="flex gap-2">
                                                <button onClick={() => setGameMode('auto')} className={`flex-1 py-2 rounded-lg font-bold text-sm border-2 ${gameMode === 'auto' ? 'bg-indigo-100 border-indigo-500 text-indigo-700' : 'bg-white border-slate-200 text-slate-500'}`}><Globe className="w-4 h-4 inline mr-1"/> Auto</button>
                                                <button onClick={() => setGameMode('custom')} className={`flex-1 py-2 rounded-lg font-bold text-sm border-2 ${gameMode === 'custom' ? 'bg-indigo-100 border-indigo-500 text-indigo-700' : 'bg-white border-slate-200 text-slate-500'}`}><PenTool className="w-4 h-4 inline mr-1"/> Custom</button>
                                            </div>
                                            {gameMode === 'custom' && (
                                                <div className="mt-3 flex gap-2">
                                                    <input type="text" placeholder="Word 1" value={customNormal} onChange={e => setCustomNormal(e.target.value)} className="w-1/2 p-2 rounded-lg border-2 border-slate-300 text-sm"/>
                                                    <input type="text" placeholder="Word 2" value={customImposter} onChange={e => setCustomImposter(e.target.value)} className="w-1/2 p-2 rounded-lg border-2 border-slate-300 text-sm"/>
                                                </div>
                                            )}
                                        </div>
                                        <button onClick={startGame} disabled={playersList.length < 3 || isLoadingWords} className={`w-full py-4 rounded-xl font-title text-2xl tracking-wide flex justify-center gap-3 comic-shadow active:translate-y-1 active:shadow-none ${playersList.length < 3 ? 'bg-slate-300 text-slate-500 cursor-not-allowed border-slate-400' : 'bg-green-400 hover:bg-green-300 text-black'}`}>{isLoadingWords ? <Loader2 className="w-8 h-8 animate-spin"/> : <><Play className="w-8 h-8 fill-current" /> START GAME</>}</button>
                                    </div>
                                ) : (
                                    <div className="text-center p-6 text-slate-500 bg-white border-2 border-dashed border-slate-300 rounded-xl animate-pulse font-bold text-lg">Waiting for host...</div>
                                )}
                                {playersList.length < 3 && isHost && <div className="bg-yellow-100 border-2 border-yellow-400 text-yellow-800 p-2 rounded-lg text-center font-bold">Need 3+ players!</div>}
                            </div>
                        </div>
                    )}

                    {view === 'game' && (
                        <div className="min-h-screen p-4 pb-24">
                            <div className="max-w-md mx-auto space-y-6 mt-4">
                                <div className="flex justify-between items-center mb-4 gap-2">
                                    <button onClick={leaveRoom} className="bg-white border-2 border-slate-300 text-slate-700 px-3 py-2 rounded-xl font-bold text-xs md:text-sm hover:bg-slate-50 flex items-center gap-1 shadow-sm shrink-0"><ArrowLeft className="w-4 h-4" /> LEAVE</button>
                                    <div className="bg-yellow-400 border-2 border-black text-black px-3 py-1.5 rounded-full font-title tracking-wide text-base md:text-lg shadow-[2px_2px_0_0_rgba(0,0,0,1)] transform -rotate-2 truncate max-w-[150px] md:max-w-xs">{playerName}</div>
                                </div>
                                <div className="flex justify-between items-center bg-white p-4 rounded-xl comic-card">
                                    <div className="flex items-center gap-2"><div className="bg-indigo-100 p-2 rounded-lg border-2 border-indigo-200"><Users className="w-5 h-5 text-indigo-600" /></div><span className="font-title text-lg md:text-xl text-slate-700">{playersList.filter(p=>!p.isEliminated).length} Alive</span></div>
                                    <div className={`px-4 py-1 rounded-full text-xs md:text-sm font-title tracking-wide border-2 ${roomData.status === 'ended' ? 'bg-red-100 border-red-400 text-red-600' : roomData.status === 'voting' ? 'bg-yellow-100 border-yellow-400 text-yellow-700' : 'bg-green-100 border-green-400 text-green-700'}`}>{roomData.status === 'ended' ? "GAME OVER" : roomData.status === 'voting' ? "VOTING TIME" : "PLAYING"}</div>
                                </div>

                                {roomData.status !== 'ended' ? (
                                    myData.isEliminated ? (
                                        <div className="bg-gray-200 p-8 rounded-2xl comic-card text-center border-4 border-gray-400"><img src="sura85.png" onError={(e) => { e.target.onerror = null; e.target.src = "https://placehold.co/150x150/9ca3af/ffffff?text=DEAD"; }} className="w-24 h-24 md:w-32 md:h-32 mx-auto mb-4 object-contain" alt="Eliminated" /><h2 className="font-title text-3xl md:text-4xl text-gray-600">ELIMINATED</h2><p className="text-gray-500 font-bold mt-2">You are now a spectator</p></div>
                                    ) : (
                                        <div className="relative w-full h-64 md:h-72 cursor-pointer group" onClick={() => setRevealWord(!revealWord)}>
                                            <div className={`card-flip w-full h-full ${revealWord ? 'flipped' : ''}`}>
                                                <div className="card-inner w-full h-full comic-card rounded-2xl bg-white">
                                                    <div className="card-front bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] bg-indigo-600 text-white rounded-xl border-4 border-indigo-800"><Eye className="w-16 h-16 mb-4 text-yellow-300 animate-bounce" /><h3 className="font-title text-4xl text-yellow-300 drop-shadow-md">TAP TO REVEAL</h3><p className="font-bold text-indigo-200 mt-2 bg-indigo-800 px-3 py-1 rounded-full">Secret info inside!</p></div>
                                                    <div className="card-back bg-white rounded-xl"><div className="text-center w-full px-4"><p className="text-slate-400 font-bold uppercase tracking-widest mb-2 text-sm">The Category is</p><p className="font-title text-2xl md:text-3xl text-indigo-600 mb-8 border-b-2 border-dashed border-indigo-100 pb-4 mx-8">{roomData.category}</p><p className="text-slate-400 font-bold uppercase tracking-widest mb-2 text-sm">Your Secret Word</p><h2 className="font-title text-4xl md:text-5xl text-slate-800 drop-shadow-sm">{myWord}</h2><div className="mt-8 flex items-center justify-center gap-2 text-slate-400 font-bold text-sm bg-slate-100 py-2 rounded-full mx-10"><EyeOff className="w-4 h-4" /> Tap again to hide</div></div></div>
                                                </div>
                                            </div>
                                        </div>
                                    )
                                ) : (
                                    <div className="bg-white p-8 rounded-2xl comic-card text-center space-y-6">
                                        <div><p className="text-slate-400 font-title text-xl tracking-wider">THE IMPOSTER WAS</p><div className="mt-4 flex flex-col items-center"><div className="w-24 h-24 md:w-32 md:h-32 flex items-center justify-center mb-3"><img src="sura80.png" onError={(e) => { e.target.onerror = null; e.target.src = "https://placehold.co/150x150/ef4444/ffffff?text=IMPOSTER"; }} className="w-full h-full object-contain animate-bounce" alt="Imposter" /></div><h2 className="font-title text-3xl md:text-4xl text-slate-800">{playersList.find(p => p.uid === roomData.imposterId)?.name || 'Unknown'}</h2></div></div>
                                        <div className="grid grid-cols-2 gap-4 pt-6 border-t-2 border-dashed border-slate-200">
                                            <div className="bg-blue-50 p-3 rounded-xl border-2 border-blue-200"><p className="text-xs font-bold text-blue-400 mb-1 uppercase">Common Word</p><p className="font-title text-lg md:text-xl text-blue-700">{roomData.commonWord}</p></div>
                                            <div className="bg-red-50 p-3 rounded-xl border-2 border-red-200"><p className="text-xs font-bold text-red-400 mb-1 uppercase">Imposter Word</p><p className="font-title text-lg md:text-xl text-red-700">{roomData.imposterWord}</p></div>
                                        </div>
                                    </div>
                                )}

                                {roomData.status === 'voting' && (
                                    <div className="bg-white p-4 rounded-2xl comic-card"><h3 className="font-title text-2xl text-slate-800 mb-4 flex items-center gap-2"><Vote className="w-6 h-6 text-indigo-500" /> VOTE THE IMPOSTER</h3><div className="grid grid-cols-1 gap-3">{playersList.map(p => { if (p.uid === user.uid) return null; const isSelected = myVote === p.uid; const isDead = p.isEliminated; return (<button key={p.uid} onClick={() => !isDead && castVote(p.uid)} disabled={isDead} className={`w-full p-4 rounded-xl flex items-center justify-between transition border-2 font-bold text-lg ${isDead ? 'bg-gray-100 border-gray-200 text-gray-400 cursor-not-allowed' : isSelected ? 'bg-indigo-100 border-indigo-500 text-indigo-800 shadow-inner' : 'bg-white border-slate-200 text-slate-600 hover:bg-slate-50 hover:border-slate-300'}`}><span className="flex items-center gap-2">{p.name}{isDead && <Skull className="w-4 h-4"/>}</span>{isSelected && <CheckCircle2 className="w-6 h-6 text-indigo-600" />}</button>) })}</div>{myData.isEliminated && <p className="text-center text-red-500 font-bold mt-2 text-sm">Eliminated players cannot vote.</p>}</div>
                                )}

                                {(roomData.status === 'voting' || roomData.status === 'ended') && (
                                    <div className="bg-white p-4 rounded-2xl comic-card"><h3 className="font-title text-lg text-slate-400 mb-3">LIVE RESULTS</h3><div className="space-y-4">{playersList.map(p => { const count = voteCounts[p.uid] || 0; const isMax = count === maxVotes && maxVotes > 0; return (<div key={p.uid} className={`flex items-center gap-3 ${p.isEliminated ? 'opacity-50 grayscale' : ''}`}><div className="flex-1"><div className="flex justify-between text-sm mb-1 font-bold"><span className="text-slate-700 flex items-center gap-1">{p.name} {p.isEliminated && 'ðŸ’€'}</span><span className="text-slate-500">{count} votes</span></div><div className="w-full bg-slate-100 rounded-full h-4 border-2 border-slate-200 overflow-hidden"><div className={`h-full transition-all duration-500 ${isMax ? 'bg-red-500' : 'bg-slate-400'}`} style={{ width: `${(count / playersList.length) * 100}%` }}></div></div></div></div>); })} {Object.keys(voteCounts).length === 0 && <p className="text-sm text-slate-400 font-bold text-center py-2">No votes cast yet!</p>}</div></div>
                                )}

                                {isHost && (
                                    <div className="fixed bottom-0 left-0 w-full bg-white border-t-2 border-slate-200 p-4 shadow-xl z-20 safe-area-bottom">
                                        <div className="max-w-md mx-auto grid grid-cols-2 gap-3">
                                            {roomData.status !== 'ended' ? (
                                                <>{roomData.status === 'voting' ? (<button onClick={handleVoteCompletion} className="bg-yellow-400 hover:bg-yellow-300 text-black py-3 px-4 rounded-xl font-title text-xl transition flex items-center justify-center gap-2 comic-shadow active:translate-y-1 active:shadow-none"><Vote className="w-5 h-5" /> TALLY VOTES</button>) : (<button onClick={toggleVoting} className="bg-indigo-500 hover:bg-indigo-400 text-white py-3 px-4 rounded-xl font-title text-xl transition flex items-center justify-center gap-2 comic-shadow active:translate-y-1 active:shadow-none"><Vote className="w-5 h-5" /> START VOTING</button>)}<button onClick={endGame} className="bg-red-500 hover:bg-red-400 text-white py-3 px-4 rounded-xl font-title text-xl transition flex items-center justify-center gap-2 comic-shadow active:translate-y-1 active:shadow-none"><ShieldAlert className="w-5 h-5" /> END GAME</button></>
                                            ) : (
                                                <><button onClick={startGame} disabled={isLoadingWords} className="col-span-1 bg-green-500 text-white hover:bg-green-400 py-3 px-4 rounded-xl font-title text-xl transition flex items-center justify-center gap-2 comic-shadow active:translate-y-1 active:shadow-none"><Shuffle className="w-5 h-5" /> RESTART</button><button onClick={resetToLobby} className="col-span-1 bg-slate-200 text-slate-700 hover:bg-slate-300 py-3 px-4 rounded-xl font-title text-xl transition flex items-center justify-center gap-2 comic-shadow active:translate-y-1 active:shadow-none"><LogOut className="w-5 h-5" /> LOBBY</button></>
                                            )}
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
